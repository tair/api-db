--
-- Copyright 2011 Carnegie Institution for Science. All rights reserved.
--
-- Generated by AndroMDA Poesys/DB cartridge: DO NOT EDIT DIRECTLY.
-- Template: SubsystemMySqlSchemaTables.vsl

-- SQL schema for api subsystem

CREATE TABLE Partner (
  partnerId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  name VARCHAR(500) NOT NULL,  
  logoUri VARCHAR(200),  
  termOfServiceUri VARCHAR(200),  
  CONSTRAINT PartnerPK PRIMARY KEY (partnerId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE SubscriptionTerm (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  period INT(8) NOT NULL,  
  price NUMERIC(6, 2) NOT NULL,  
  groupDiscountPercentage NUMERIC(6, 2) NOT NULL,  
  description VARCHAR(200) NOT NULL,  
  CONSTRAINT SubscriptionTermPK PRIMARY KEY (partnerId, period)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE PartnerPattern (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  sourceUri VARCHAR(200) NOT NULL,  
  targetUri VARCHAR(200) NOT NULL,  
  CONSTRAINT PartnerPatternPK PRIMARY KEY (partnerId, sourceUri)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE SubscriptionDescription (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  header VARCHAR(200) NOT NULL,  
  descriptionType VARCHAR(200) NOT NULL,  
  CONSTRAINT SubscriptionDescriptionPK PRIMARY KEY (header, partnerId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE SubscriptionDescriptionItem (
  header VARCHAR(200) NOT NULL,  
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  itemNo BIGINT,  
  text VARCHAR(2048) NOT NULL,  
  CONSTRAINT SubscriptionDescriptionItemPK PRIMARY KEY (header, itemNo, partnerId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE ApiKey (
  apiKeyId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  apiKey VARCHAR(200) NOT NULL,  
  CONSTRAINT ApiKeyPK PRIMARY KEY (apiKeyId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE Login (
  partyId ${col.sqlTypeMySql51} NOT NULL,  
  username VARCHAR(200) NOT NULL,  
  password VARCHAR(100) NOT NULL,  
  email VARCHAR(200),  
  institution VARCHAR(100),  
  userIdentifier VARCHAR(100),  
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  CONSTRAINT LoginPK PRIMARY KEY (partyId, username)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE AccessType (
  accessTypeId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  name VARCHAR(200) NOT NULL,  
  CONSTRAINT AccessTypePK PRIMARY KEY (accessTypeId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE UriPattern (
  uriPatternId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  pattern VARCHAR(200) NOT NULL,  
  CONSTRAINT UriPatternPK PRIMARY KEY (uriPatternId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE AccessRule (
  accessTypeId ${col.sqlTypeMySql51} NOT NULL,  
  uriPatternId ${col.sqlTypeMySql51} NOT NULL,  
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  CONSTRAINT AccessRulePK PRIMARY KEY (accessTypeId, partnerId, uriPatternId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE PageView (
  pageViewId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  pageViewDate TIMESTAMP NOT NULL,  
  uri VARCHAR(250) NOT NULL,  
  ip VARCHAR(200) NOT NULL,  
  sessionId VARCHAR(250) NOT NULL,  
  partyId ${col.sqlTypeMySql51},  
  CONSTRAINT PageViewPK PRIMARY KEY (pageViewId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE IpCount (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  ip VARCHAR(200) NOT NULL,  
  count INT NOT NULL,  
  CONSTRAINT IpCountPK PRIMARY KEY (ip, partnerId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE LimitValue (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  value INT NOT NULL,  
  CONSTRAINT LimitValuePK PRIMARY KEY (partnerId, value)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE Party (
  partyId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  name VARCHAR(200) NOT NULL,  
  partyType VARCHAR(200) NOT NULL,  
  CONSTRAINT PartyPK PRIMARY KEY (partyId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE Country (
  countryId ${col.sqlTypeMySql51} NOT NULL, -- generated by sequence  
  name VARCHAR(200) NOT NULL,  
  CONSTRAINT CountryPK PRIMARY KEY (countryId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE IpRange (
  partyId ${col.sqlTypeMySql51} NOT NULL,  
  startIp VARCHAR(200) NOT NULL,  
  endIp VARCHAR(200) NOT NULL,  
  CONSTRAINT IpRangePK PRIMARY KEY (partyId, startIp)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE ActivationCode (
  activationCodeId VARCHAR(50) NOT NULL,  
  period INT(8) NOT NULL,  
  purchaseDate TIMESTAMP NOT NULL,  
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  CONSTRAINT ActivationCodePK PRIMARY KEY (activationCodeId)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE SubscriptionTransaction (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  partyId ${col.sqlTypeMySql51} NOT NULL,  
  transactionNo BIGINT,  
  transactionDate TIMESTAMP NOT NULL,  
  startDate TIMESTAMP NOT NULL,  
  endDate TIMESTAMP NOT NULL,  
  transactionType VARCHAR(50) NOT NULL,  
  activationCodeId VARCHAR(50),  
  CONSTRAINT SubscriptionTransactionPK PRIMARY KEY (partnerId, partyId, transactionNo)
) ENGINE=InnoDB CHARSET=utf8;

CREATE TABLE Subscription (
  partnerId ${col.sqlTypeMySql51} NOT NULL,  
  partyId ${col.sqlTypeMySql51} NOT NULL,  
  startDate TIMESTAMP NOT NULL,  
  endDate TIMESTAMP NOT NULL,  
  subscriptionId BIGINT NOT NULL,  
  CONSTRAINT SubscriptionPK PRIMARY KEY (partnerId, partyId)
) ENGINE=InnoDB CHARSET=utf8;

