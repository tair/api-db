--
-- Copyright 2011 Carnegie Institution for Science. All rights reserved.
--
-- Generated by AndroMDA Poesys/DB cartridge: DO NOT EDIT DIRECTLY.
-- Template: SubsystemOracleSchemaTables.vsl

-- Oracle SQL schema for api subsystem

CREATE TABLE Partner (
  partnerId VARCHAR2(500),  
  name VARCHAR2(500) NOT NULL,  
  logoUri VARCHAR2(200),  
  termOfServiceUri VARCHAR2(200),  
  CONSTRAINT PartnerPK PRIMARY KEY (partnerId)
);

CREATE TABLE SubscriptionTerm (
  partnerId VARCHAR2(500),  
  period NUMBER(12)(8) NOT NULL,  
  price BINARY_DOUBLE(6, 2) NOT NULL,  
  groupDiscountPercentage BINARY_DOUBLE(6, 2) NOT NULL,  
  description VARCHAR2(200) NOT NULL,  
  CONSTRAINT SubscriptionTermPK PRIMARY KEY (partnerId, period)
);

CREATE TABLE PartnerPattern (
  partnerId VARCHAR2(500),  
  sourceUri VARCHAR2(200) NOT NULL,  
  targetUri VARCHAR2(200) NOT NULL,  
  CONSTRAINT PartnerPatternPK PRIMARY KEY (partnerId, sourceUri)
);

CREATE TABLE SubscriptionDescription (
  partnerId VARCHAR2(500),  
  descriptionType VARCHAR2(200) NOT NULL,  
  header VARCHAR2(200) NOT NULL,  
  CONSTRAINT SubscriptionDescriptionPK PRIMARY KEY (descriptionType, partnerId)
);

CREATE TABLE SubscriptionDescriptionItem (
  descriptionType VARCHAR2(200) NOT NULL,  
  partnerId VARCHAR2(500),  
  itemNo NUMBER(38),  
  text VARCHAR2(2048) NOT NULL,  
  CONSTRAINT SubscriptionDescriptionItemPK PRIMARY KEY (descriptionType, itemNo, partnerId)
);

CREATE TABLE ApiKey (
  apiKeyId NUMBER(38) NOT NULL, -- generated by sequence  
  apiKey VARCHAR2(200) NOT NULL,  
  CONSTRAINT ApiKeyPK PRIMARY KEY (apiKeyId)
);

CREATE TABLE Login (
  partyId NUMBER(38) NOT NULL,  
  username VARCHAR2(200) NOT NULL,  
  password VARCHAR2(100) NOT NULL,  
  email VARCHAR2(200),  
  institution VARCHAR2(100),  
  userIdentifier VARCHAR2(100),  
  partnerId VARCHAR2(500) NOT NULL,  
  CONSTRAINT LoginPK PRIMARY KEY (partyId, username)
);

CREATE TABLE AccessType (
  accessTypeId NUMBER(38) NOT NULL, -- generated by sequence  
  name VARCHAR2(200) NOT NULL,  
  CONSTRAINT AccessTypePK PRIMARY KEY (accessTypeId)
);

CREATE TABLE UriPattern (
  uriPatternId NUMBER(38) NOT NULL, -- generated by sequence  
  pattern VARCHAR2(200) NOT NULL,  
  CONSTRAINT UriPatternPK PRIMARY KEY (uriPatternId)
);

CREATE TABLE AccessRule (
  accessTypeId NUMBER(38) NOT NULL,  
  uriPatternId NUMBER(38) NOT NULL,  
  partnerId VARCHAR2(500),  
  CONSTRAINT AccessRulePK PRIMARY KEY (accessTypeId, partnerId, uriPatternId)
);

CREATE TABLE PageView (
  pageViewId NUMBER(38) NOT NULL, -- generated by sequence  
  pageViewDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  uri VARCHAR2(250) NOT NULL,  
  ip VARCHAR2(200) NOT NULL,  
  sessionId VARCHAR2(250) NOT NULL,  
  partyId NUMBER(38),  
  CONSTRAINT PageViewPK PRIMARY KEY (pageViewId)
);

CREATE TABLE IpCount (
  partnerId VARCHAR2(500),  
  ip VARCHAR2(200) NOT NULL,  
  count NUMBER(12) NOT NULL,  
  CONSTRAINT IpCountPK PRIMARY KEY (ip, partnerId)
);

CREATE TABLE LimitValue (
  partnerId VARCHAR2(500),  
  value NUMBER(12) NOT NULL,  
  CONSTRAINT LimitValuePK PRIMARY KEY (partnerId, value)
);

CREATE TABLE Party (
  partyId NUMBER(38) NOT NULL, -- generated by sequence  
  name VARCHAR2(200) NOT NULL,  
  partyType VARCHAR2(200) NOT NULL,  
  display NUMBER(1) NOT NULL,  
  countryId NUMBER(38),  
  CONSTRAINT PartyPK PRIMARY KEY (partyId)
);

CREATE TABLE Country (
  countryId NUMBER(38) NOT NULL, -- generated by sequence  
  name VARCHAR2(200) NOT NULL,  
  CONSTRAINT CountryPK PRIMARY KEY (countryId)
);

CREATE TABLE IpRange (
  partyId NUMBER(38) NOT NULL,  
  startIp VARCHAR2(200) NOT NULL,  
  endIp VARCHAR2(200) NOT NULL,  
  CONSTRAINT IpRangePK PRIMARY KEY (partyId, startIp)
);

CREATE TABLE ActivationCode (
  activationCodeId VARCHAR2(50) NOT NULL,  
  period NUMBER(12)(8) NOT NULL,  
  purchaseDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  partnerId VARCHAR2(500) NOT NULL,  
  CONSTRAINT ActivationCodePK PRIMARY KEY (activationCodeId)
);

CREATE TABLE SubscriptionTransaction (
  partnerId VARCHAR2(500),  
  partyId NUMBER(38) NOT NULL,  
  transactionNo NUMBER(38),  
  transactionDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  startDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  endDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  transactionType VARCHAR2(50) NOT NULL,  
  activationCodeId VARCHAR2(50),  
  CONSTRAINT SubscriptionTransactionPK PRIMARY KEY (partnerId, partyId, transactionNo)
);

CREATE TABLE Subscription (
  partnerId VARCHAR2(500),  
  partyId NUMBER(38) NOT NULL,  
  startDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  endDate TIMESTAMP WITH TIME ZONE NOT NULL,  
  subscriptionId ${col.sqlTypeOracle11g} NOT NULL,  
  CONSTRAINT SubscriptionPK PRIMARY KEY (partnerId, partyId)
);

